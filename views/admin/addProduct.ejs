<%- include('../adminLayout/adminHeader.ejs') %>

<form action="/admin/addProduct" method="post" class="form-horizontal" enctype="multipart/form-data">
  <fieldset class="mx-auto" style="max-width: 600px;">
  
  <!-- Form Name -->
  <legend class="text-center">PRODUCTS</legend>
  
  <!-- Name-->
  <div class="form-group">
    <label class="col-md-12 control-label text-center" for="product_name">PRODUCT NAME</label>  
    <div class="col-md-12 text-center">
      <input name="name" placeholder="PRODUCT NAME" class="form-control input-md" required style="margin-bottom: 10px;">
    </div>
  </div>
  
  <!-- Category -->
  <div class="form-group">
    <label class="col-md-12 control-label text-center" for="category">PRODUCT CATEGORY</label>
    <div class="col-md-12 text-center">
      <select name="category_id" class="form-control" required style="margin-bottom: 10px;">
          <% for(let i=0; i < categories.length; i++) { %>
              <option value="<%= categories[i]._id %>"><%= categories[i].name %></option>
          <% } %>
      </select>
    </div>
  </div>

  <!-- Stock-->
  <div class="form-group">
    <label class="col-md-12 control-label text-center" for="stock">AVAILABLE QUANTITY</label>  
    <div class="col-md-12 text-center">
      <input name="stock" placeholder=" Stock" class="form-control input-md" required style="margin-bottom: 10px;">
    </div>
  </div>
  
  <!-- Size-->
  <div class="form-group">
    <label class="col-md-12 control-label text-center" for="size"> Size</label>  
    <div class="col-md-12 text-center">
      <select name="size" class="form-control" required style="margin-bottom: 10px;">
          <option value="S">S</option>
          <option value="M">M</option>
          <option value="L">L</option>
          <option value="XL">XL</option>
          <option value="XXL">XXL</option>
      </select>
    </div>
  </div>

  <!-- Price-->
  <div class="form-group">
    <label class="col-md-12 control-label text-center" for="stock">Price</label>  
    <div class="col-md-12 text-center">
      <input name="price" placeholder=" Price" class="form-control input-md" required style="margin-bottom: 10px;">
    </div>
  </div>
  
  <!-- Description -->
  <div class="form-group">
    <label class="col-md-12 control-label text-center" for="description">PRODUCT DESCRIPTION</label>
    <div class="col-md-12 text-center">                     
      <textarea class="form-control" id="description" name="description" required style="margin-bottom: 10px;"></textarea>
    </div>
  </div>

  

  <!-- Image preview -->
  <div id="imagePreview" class="mt-3" style="display: flex; gap: 10px; margin-bottom: 10px;"></div>

  <input type="hidden" name="imageUrls" id="imageUrls" value="<%= JSON.stringify([]) %>">

  <!-- Images -->
  <div class="form-group">
    <label class="col-md-12 control-label text-center" for="filebutton">Images</label>
    <div class="col-md-12 text-center">
      <input name="image" class="input-file" type="file" multiple multiple onchange="previewImages(event)" style="margin-bottom: 10px;">
    </div>
  </div>
  
  <!-- Button -->
  <div class="form-group">
    <div class="col-md-12 text-center">
      <button type="submit" class="btn btn-primary">Add Product</button>
    </div>
  </div>
  
  </fieldset>
</form>
<%- include('../adminLayout/adminFooter.ejs') %>

<script>
  let selectedImages = [];

  function previewImages(event) {
      const previewContainer = document.getElementById('imagePreview');
      const files = event.target.files;

      for (const file of files) {
          const reader = new FileReader();

          reader.onload = function (e) {
              const imgContainer = document.createElement('div');
              imgContainer.style.display = 'flex';
              imgContainer.style.flexDirection = 'column';

              const img = document.createElement('img');
              img.src = e.target.result;
              img.alt = 'Image Preview';
              img.style.width = '100px'; // Adjust the width as needed

              const closeIcon = document.createElement('img');
              closeIcon.src = 'https://www.freeiconspng.com/thumbs/remove-icon-png/remove-icon-png-15.png';
              closeIcon.alt = 'Remove Image';
              closeIcon.style.width = '20px'; // Adjust the width as needed
              closeIcon.style.cursor = 'pointer';
              closeIcon.onclick = function () {
                  imgContainer.remove();
                  // Remove the image from the selectedImages array
                  selectedImages = selectedImages.filter(image => image !== img.src);
                  updateHiddenInput();
              };

              imgContainer.appendChild(img);
              imgContainer.appendChild(closeIcon);
              previewContainer.appendChild(imgContainer);

              // Add the image to the selectedImages array
              selectedImages.push(img.src);
              updateHiddenInput();
          };

          reader.readAsDataURL(file);
      }
  }

  function updateHiddenInput() {
      const hiddenInput = document.getElementById('imageUrls');
      hiddenInput.value = JSON.stringify(selectedImages);
  }
</script>
