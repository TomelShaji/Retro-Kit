<%- include('../userLayouts/userMainHeader.ejs') %>
    <header>
        <!-- Heading -->
        <div class="bg-dark">
            <div class="container py-4">
                <!-- Breadcrumb -->
                <nav class="d-flex">
                    <h6 class="mb-0">
                        <a href="/home" class="text-white-50">Home</a>
                        <span class="text-white-50 mx-2"> > </span>
                        <a href="/shop" class="text-white-50">Shop</a>
                        <span class="text-white-50 mx-2"> > </span>
                        <a href="/productDetail/:id" class="text-white"><u>Product</u></a>
                    </h6>
                </nav>
                <!-- Breadcrumb -->
            </div>
        </div>
        <!-- Heading -->
    </header>

    <!-- content -->
    <section class="py-5">
        <div class="container">
            <div class="row gx-5">
                <aside class="col-lg-6">
                    <figure id="mainImage" class="zoom"
                        style="background-image: url('/productImages/<%= productData.image[0] %>')"
                        onmousemove="zoom(event)">
                        <img src="/productImages/<%= productData.image[0] %>" alt="<%= productData.name %> Image 1" />
                    </figure>

                    <div class="d-flex justify-content-center mb-3">
                        <% productData.image.forEach((image, index)=> { %>
                            <a class="border mx-1 rounded-2" data-type="image"
                                onclick="updateMainImage('/productImages/<%= image %>')">
                                <img width="60" height="60" class="rounded-2" src="/productImages/<%= image %>"
                                    alt="<%= productData.name %> Image <%= index + 1 %>" />
                            </a>
                            <% }); %>
                    </div>
                </aside>



                <main class="col-lg-6">
                    <div class="ps-lg-3">
                        <h4 class="title text-dark">
                            <%= productData.name %>
                        </h4>


                        <div class="mb-3">
                            <span class="h5">â‚¹ <%= productData.price %></span>
                        </div>

                        <p>
                            <%= productData.description %>
                        </p>

                        <div class="row">
                            <dt class="col-3">Size</dt>
                            <dd class="col-9">
                                <%= productData.size %>
                            </dd>

                            <dt class="col-3">In Stock</dt>
                            <dd class="col-9">
                                <%= productData.stock %>
                            </dd>

                            <dt class="col-3">Category</dt>
                            <dd class="col-9">
                                <%= productData.category_id.name %>
                            </dd>
                        </div>

                        <hr />

                        <!-- <div class="row mb-4">

                             col.// 
                            <div class="col-md-4 col-6 mb-3">
                                <form id="buyNowForm" action="/buyNow/<%= productData._id %>" method="post">


                                    <label class="mb-2 d-block">Quantity</label>
                                    <div class="input-group mb-3" style="width: 170px;">



                                        <button class="btn btn-white border border-secondary px-3" type="button"
                                            id="decreaseQty" data-mdb-ripple-color="dark">
                                            <i class="fa fa-minus" aria-hidden="true"></i>
                                        </button>
                                        <input type="number" id="quantityInput" name="quantity" value="1"
                                            class="form-control text-center border border-secondary" placeholder="1"
                                            aria-label="Example text with button addon"
                                            aria-describedby="button-addon1" />
                                        <button class="btn btn-white border border-secondary px-3" type="button"
                                            id="increaseQty" data-mdb-ripple-color="dark">
                                            <i class="fa fa-plus" aria-hidden="true"></i>

                                        </button>
                                    </div>
                                    <span class="text-success mb-3" id="availableStock">Available stock: <%= productData.stock %></span>
                                    <button type="submit" id="buyNowBtn" class="btn btn-warning shadow-0"> Buy now
                                    </button>
                                    <div id="stockMessage" class="text-danger mb-3" style="display: none;"></div>
                                </form>
                            </div>
                        </div>
                        <div class="row mb-4">
                            <div class="col-md-4 col-6 mb-3">

                                <div class="col-md-12 col-12 mb-3">
                                    <form action="/addToCart/<%= productData._id %>" method="post">
                                        <button type="submit" class="btn btn-dark shadow-0">
                                            <i class="me-1 fa fa-shopping-basket"></i> Add to Cart
                                        </button>
                                    </form>
                                </div>
                                <div class="col-md-12 col-12 mb-3">
                                    <form action="/addToWishlist/<%= productData._id %>" method="post">
                                        <button type="submit"
                                            class="btn btn-light border border-secondary py-2 icon-hover px-3">
                                            <i class="me-1 fa fa-heart fa-lg"></i> Add to Wishlist
                                        </button>
                                    </form>
                                </div>
                            </div>



                        </div> -->
                        <div class="row mb-4">
                            <div class="col-md-4 col-12 mb-3">
                                <form id="buyNowForm" action="/buyNow/<%= productData._id %>" method="post">
                                    <label class="mb-2 d-block">Quantity</label>
                                    <div class="input-group mb-3" style="width: 170px;">
                                        <button class="btn btn-white border border-secondary px-3" type="button" id="decreaseQty" data-mdb-ripple-color="dark">
                                            <i class="fa fa-minus" aria-hidden="true"></i>
                                        </button>
                                        <input type="number" id="quantityInput" name="quantity" value="1" class="form-control text-center border border-secondary" placeholder="1" aria-label="Example text with button addon" aria-describedby="button-addon1" />
                                        <button class="btn btn-white border border-secondary px-3" type="button" id="increaseQty" data-mdb-ripple-color="dark">
                                            <i class="fa fa-plus" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                    <span class="text-success mb-3" id="availableStock">Available stock: <%= productData.stock %></span>
                                    <button type="submit" id="buyNowBtn" class="btn btn-warning shadow-0 w-100">Buy now</button>
                                    <div id="stockMessage" class="text-danger mb-3" style="display: none;"></div>
                                </form>
                            </div>
                            <div class="col-md-4 col-12 mb-3 d-flex align-items-end">
                                <form action="/addToCart/<%= productData._id %>" method="post">
                                    <button type="submit" class="btn btn-dark shadow-0 w-100">
                                        <i class="me-1 fa fa-shopping-basket"></i> Add to Cart
                                    </button>
                                </form>
                            </div>
                            <div class="col-md-4 col-12 mb-3 d-flex align-items-end">
                                <form action="/addToWishlist/<%= productData._id %>" method="post">
                                    <button type="submit" class="btn btn-light border border-secondary py-2 icon-hover px-3 w-100">
                                         Add to Wishlist
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        
                        
                </main>
            </div>
        </div>
    </section>
    <!-- content -->




    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/js-image-zoom@0.4.1/js-image-zoom.js"></script>
    <script>
        function zoom(e) {
            var zoomer = e.currentTarget;
            var offsetX = e.offsetX || e.touches[0].pageX;
            var offsetY = e.offsetY || e.touches[0].pageY;

            var x = (offsetX / zoomer.offsetWidth) * 100;
            var y = (offsetY / zoomer.offsetHeight) * 100;

            zoomer.style.backgroundPosition = x + '% ' + y + '%';
        }

        function updateMainImage(imageUrl) {
            var mainImage = document.getElementById('mainImage');
            var mainImageElement = mainImage.querySelector('img');

            mainImage.style.backgroundImage = 'url(' + imageUrl + ')';
            mainImageElement.src = imageUrl;
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const addToWishlistForm = document.querySelector('#addToWishlistForm');

            addToWishlistForm.addEventListener('submit', async function (event) {
                event.preventDefault();

                const productId = '<%= productData._id %>';

                try {
                    //  AJAX request to add the product to the wishlist
                    const response = await fetch(`/addToWishlist/${productId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },

                    });

                    if (response.ok) {

                        alert('Product added to Wishlist!');
                    } else {

                        alert('Failed to add product to Wishlist');
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            });
        });
    </script>

    <script>
        // Decrease Quantity
        document.getElementById('decreaseQty').onclick = function () {
            var quantityInput = document.getElementById('quantityInput');
            var currentValue = parseInt(quantityInput.value);

            if (currentValue > 1) {
                quantityInput.value = currentValue - 1;
            }
        };

        // Increase Quantity
        document.getElementById('increaseQty').onclick = function () {
            var quantityInput = document.getElementById('quantityInput');
            var currentValue = parseInt(quantityInput.value);

            quantityInput.value = currentValue + 1;
        };
    </script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const buyNowForm = document.querySelector('#buyNowForm');
        const quantityInput = document.getElementById('quantityInput');
        const stockMessage = document.getElementById('stockMessage');

        buyNowForm.addEventListener('submit', function (event) {
            const currentQuantity = parseInt(quantityInput.value);
            const availableStock = parseInt(document.getElementById('availableStock').innerText.split(':')[1].trim());

            if (currentQuantity <= 0) {
                stockMessage.innerText = 'Quantity must be greater than zero';
                stockMessage.style.display = 'block';
                event.preventDefault(); // Prevent form submission
            } else if (currentQuantity > availableStock) {
                stockMessage.innerText = 'Quantity exceeds available stock';
                stockMessage.style.display = 'block';
                event.preventDefault(); // Prevent form submission
            } else {
                stockMessage.style.display = 'none';
            }
        });
    });
</script>


    <%- include('../userLayouts/userMainFooter.ejs') %>